{% extends 'base.html' %}
{% block content %}
<div class="page-header d-flex justify-content-between align-items-start mb-4">
  <div>
    <h3 class="mb-1">Traspaso de inventario</h3>
    <p class="text-muted mb-0">Envía stock de una sucursal a otra con trazabilidad automática.</p>
  </div>
  <a class="btn btn-outline-secondary btn-sm" href="{% url 'inventory_by_branch' %}">← Volver al inventario</a>
</div>

{% if form_errors %}
  <div class="alert alert-danger">
    <ul class="mb-0">
      {% for error in form_errors %}<li>{{ error }}</li>{% endfor %}
    </ul>
  </div>
{% endif %}

<div class="card mb-4">
  <div class="card-body">
    <form method="post" class="row g-3">
      {% csrf_token %}
      <div class="col-md-6">
        <label class="form-label">Sucursal origen</label>
        <select name="source_branch" class="form-select" required>
          <option value="">Selecciona</option>
          {% for branch in branches %}
            <option value="{{ branch.id }}" {% if request.POST.source_branch == branch.id|stringformat:'s' %}selected{% endif %}>{{ branch.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-6">
        <label class="form-label">Sucursal destino</label>
        <select name="target_branch" class="form-select" required>
          <option value="">Selecciona</option>
          {% for branch in branches %}
            <option value="{{ branch.id }}" {% if request.POST.target_branch == branch.id|stringformat:'s' %}selected{% endif %}>{{ branch.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-6">
        <label class="form-label">Producto</label>
        <select name="product" class="form-select" required>
          <option value="">Selecciona</option>
          {% for product in products %}
            <option value="{{ product.id }}" {% if request.POST.product == product.id|stringformat:'s' %}selected{% endif %}>{{ product.name }} (SKU {{ product.sku }})</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Cantidad</label>
        <input type="number" name="quantity" min="1" value="{{ request.POST.quantity|default:'1' }}" class="form-control" required>
      </div>
      <div class="col-md-3">
        <label class="form-label">Nota (opcional)</label>
        <input type="text" name="note" value="{{ request.POST.note }}" class="form-control" placeholder="Ej: para apertura de sala">
      </div>
      <div class="col-12 text-end">
        <button type="submit" class="btn btn-primary">Registrar traspaso</button>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <p class="text-muted mb-0">Los traspasos quedan registrados como movimientos de inventario para ambas sucursales.</p>
  </div>
</div>
{% endblock %}
